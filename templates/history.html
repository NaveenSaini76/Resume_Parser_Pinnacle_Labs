<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>History &mdash; Resume Parser AI</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
</head>
<body>

<nav class="navbar-custom">
  <div class="container d-flex align-items-center justify-content-between">
    <a class="brand" href="/"><i class="bi bi-cpu-fill"></i> Resume Parser AI</a>
    <a href="/" class="nav-link-custom"><i class="bi bi-plus-circle me-1"></i>Upload New</a>
  </div>
</nav>

<div class="container py-4">
  <h2 class="fw-bold mb-1 fade-up" style="font-size:1.5rem;">
    <i class="bi bi-clock-history me-2" style="color:var(--accent-light);"></i>Parse History
  </h2>
  <p style="color:var(--text-dim); font-size:.88rem;" class="mb-4 fade-up">All previously parsed resumes stored in the database.</p>

  {% with messages = get_flashed_messages(with_categories=true) %}{% if messages %}
    {% for category, message in messages %}
      <div class="alert-custom {{ 'error' if category=='error' else 'success' }} mb-3 fade-up">
        <i class="bi bi-{{ 'exclamation-triangle-fill' if category=='error' else 'check-circle-fill' }}"></i>
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}{% endwith %}

  {% if resumes %}
  <div class="glass-card fade-up fade-up-d1">
    <div class="table-responsive">
      <table class="modern-table">
        <thead>
          <tr>
            <th>#</th>
            <th>Name</th>
            <th>Email</th>
            <th>File</th>
            <th>Parsed At</th>
            <th style="text-align:center;">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for r in resumes %}
          <tr>
            <td><span class="table-badge">{{ r.id }}</span></td>
            <td class="table-name">{{ r.name or 'Unknown' }}</td>
            <td>{{ r.email or '---' }}</td>
            <td><span class="table-badge">{{ r.filename }}</span></td>
            <td style="font-size:.8rem;">{{ r.created_at }}</td>
            <td style="text-align:center;">
              <div class="d-inline-flex gap-1">
                <a href="/view/{{ r.id }}" class="btn-sm-icon" title="View"><i class="bi bi-eye-fill"></i></a>
                <a href="/download/{{ r.id }}" class="btn-sm-icon" title="Download"><i class="bi bi-download"></i></a>
                <form action="/delete/{{ r.id }}" method="POST" class="d-inline" onsubmit="return confirm('Delete #{{ r.id }}?')">
                  <button type="submit" class="btn-sm-icon danger" title="Delete"><i class="bi bi-trash-fill"></i></button>
                </form>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <p style="color:var(--text-dim); font-size:.8rem; margin-top:12px;" class="fade-up">
    {{ resumes|length }} record{{ 's' if resumes|length != 1 else '' }}
  </p>
  {% else %}
  <div class="empty-state fade-up">
    <div class="icon"><i class="bi bi-inbox"></i></div>
    <p>No resumes parsed yet.</p>
    <a href="/" class="btn-accent mt-2"><i class="bi bi-cloud-arrow-up-fill me-2"></i>Upload your first resume</a>
  </div>
  {% endif %}
</div>

<footer class="footer-custom">Resume Parser AI &middot; Flask &middot; spaCy &middot; Bootstrap 5</footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
